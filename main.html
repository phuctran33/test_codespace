<!doctype html>
<html lang="vi">
<head>
  <!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js"></script>

<script>
  const firebaseConfig = {
  apiKey: "AIzaSyDoUbmjmF1Qah5YJNlCc5wV8jxPKvAdInw",
  authDomain: "phuc-d0260.firebaseapp.com",
  projectId: "phuc-d0260",
  storageBucket: "phuc-d0260.firebasestorage.app",
  messagingSenderId: "1008272917930",
  appId: "1:1008272917930:web:2b7f6cbd7ab45f826717d3",
  measurementId: "G-4Q0LBM46PC"
};

  const app = firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
</script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vibe UI + OSM + Weather + Translate</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ["Inter", "ui-sans-serif", "system-ui"] },
          colors: {
            brand: {
              50:"#eef2ff",100:"#e0e7ff",200:"#c7d2fe",300:"#a5b4fc",
              400:"#818cf8",500:"#6366f1",600:"#4f46e5",700:"#4338ca",
              800:"#3730a3",900:"#312e81"
            }
          }
        }
      }
    }
  </script>

  <style>
    #map { height: 450px !important; }
  </style>
</head>

<!-- POPUP LOGIN -->
<div id="loginPopup" class="fixed inset-0 bg-black/40 hidden items-center justify-center">
  <div class="bg-white p-6 rounded-2xl shadow-xl w-[350px] space-y-4">

    <h2 class="text-lg font-semibold">Đăng nhập Firebase</h2>

    <input id="emailInput" class="w-full p-3 border rounded-xl"
           placeholder="Email">

    <input id="passwordInput" type="password" class="w-full p-3 border rounded-xl"
           placeholder="Mật khẩu">

    <button id="btnLogin"
      class="w-full bg-brand-600 text-white p-3 rounded-xl">
      Đăng nhập
    </button>

    <button id="btnRegister"
      class="w-full bg-brand-700 text-white p-3 rounded-xl">
      Tạo tài khoản
    </button>

    <p id="authMessage" class="text-sm text-red-500"></p>

    <button id="btnCloseLogin"
      class="w-full bg-slate-200 p-2 rounded-xl">
      Đóng
    </button>
  </div>
</div>


<body class="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 text-slate-900">

  <div class="max-w-4xl mx-auto p-6">

    <!-- Header -->
    <header class="flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="h-10 w-10 rounded-2xl bg-brand-600"></div>
        <h1 class="text-2xl font-bold">Vibe UI</h1>
      </div>

      <!-- ⭐ Nút mở popup dịch -->
      <button id="openTranslatePopup"
        class="px-4 py-2 bg-brand-600 text-white rounded-xl shadow">
        Dịch câu
      </button>

    <button id="openLoginPopup"
  class="px-4 py-2 bg-brand-700 text-white rounded-xl shadow">
  Đăng nhập
</button>

    </header>

    <!-- Hero -->
    <section class="mt-8">
      <div class="rounded-3xl p-6 bg-white shadow-xl border border-slate-200">
        <h2 class="text-xl font-bold">Bản đồ POI + Thời tiết</h2>
        <p class="mt-2 text-slate-600">
          Nhập một địa điểm → hiện POI + thời tiết tại vị trí đó.
        </p>
      </div>
    </section>

    <!-- OSM + Weather -->
    <section class="mt-8">
      <div class="rounded-3xl p-6 bg-white border shadow space-y-4">

        <div class="flex gap-3">
          <input id="placeInput" placeholder="Nhập địa điểm..."
            class="flex-grow px-4 py-3 border rounded-xl">
          <button id="btnSearch"
            class="px-5 py-3 bg-brand-600 text-white rounded-xl">
            Tìm
          </button>
        </div>

        <div id="map" class="rounded-2xl border"></div>

        <!-- Weather -->
        <div id="weatherCard" class="mt-4 hidden p-4 bg-slate-50 rounded-xl border">
          <h4 class="font-semibold">Thời tiết</h4>
          <p id="weatherPlace"></p>
          <div class="flex items-center gap-4 mt-2">
            <div id="weatherTemp" class="text-3xl font-bold"></div>
            <div id="weatherDesc"></div>
          </div>
          <p id="weatherExtra" class="text-xs text-slate-500 mt-1"></p>
        </div>

      </div>
    </section>

    <!-- Popup dịch -->
    <div id="translatePopup"
      class="fixed inset-0 bg-black/40 hidden items-center justify-center">

      <div class="bg-white p-6 rounded-2xl shadow-xl w-[350px] space-y-4">

        <h2 class="text-lg font-semibold">Dịch tiếng Anh → Tiếng Việt</h2>

        <textarea id="translateInput" rows="3"
          class="w-full border rounded-xl p-3"
          placeholder="Nhập câu tiếng Anh..."></textarea>

        <button id="btnTranslate"
          class="px-4 py-2 w-full bg-brand-600 text-white rounded-xl">
          Dịch
        </button>

        <div>
          <p class="text-sm font-semibold">Kết quả:</p>
          <p id="translateOutput" class="p-3 bg-slate-100 rounded-xl min-h-[60px]"></p>
        </div>

        <button id="btnClosePopup"
          class="px-4 py-2 w-full bg-slate-200 rounded-xl">
          Đóng
        </button>

      </div>
    </div>

    <footer class="py-10 text-sm text-center text-slate-500">
      Made with ♥ in Codespaces
    </footer>

  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- ⭐ Script -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {

      const OPENWEATHER_API_KEY = "fb859b8c1e888ad0d20514555a8755e2";

      /* ======================
         MAP + POI + WEATHER
      =======================*/

      const map = L.map("map").setView([10.76, 106.66], 13);
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

      const btnSearch = document.getElementById("btnSearch");
      const placeInput = document.getElementById("placeInput");

      const weatherCard  = document.getElementById("weatherCard");
      const weatherPlace = document.getElementById("weatherPlace");
      const weatherTemp  = document.getElementById("weatherTemp");
      const weatherDesc  = document.getElementById("weatherDesc");
      const weatherExtra = document.getElementById("weatherExtra");

      async function geocode(q) {
        const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(q)}&limit=1`;
        const res = await fetch(url);
        const data = await res.json();
        return data[0] || null;
      }

      async function fetchPOI(lat, lon) {
        const query = `
          [out:json];
          node(around:800, ${lat}, ${lon})["amenity"];
          out;
        `;
        const res = await fetch("https://overpass-api.de/api/interpreter", {
          method: "POST",
          body: query
        });
        return (await res.json()).elements.slice(0, 5);
      }

      async function fetchWeather(lat, lon) {
        const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${OPENWEATHER_API_KEY}&units=metric&lang=vi`;
        return await (await fetch(url)).json();
      }

      btnSearch.onclick = async () => {

        const q = placeInput.value.trim();
        if (!q) return alert("Nhập địa điểm!");

        const loc = await geocode(q);
        if (!loc) return alert("Không tìm thấy!");

        map.setView([loc.lat, loc.lon], 15);

        map.eachLayer(l => { if (l instanceof L.Marker) map.removeLayer(l); });

        const pois = await fetchPOI(loc.lat, loc.lon);
        pois.forEach(p => {
          L.marker([p.lat, p.lon])
            .addTo(map)
            .bindPopup(p.tags.name || "(không tên)");
        });

        const w = await fetchWeather(loc.lat, loc.lon);
        weatherCard.classList.remove("hidden");
        weatherPlace.textContent = loc.display_name;
        weatherTemp.textContent = Math.round(w.main.temp) + "°C";
        weatherDesc.textContent = w.weather[0].description;
        weatherExtra.textContent =
          `Cảm giác như ${Math.round(w.main.feels_like)}°C • Độ ẩm ${w.main.humidity}%`;

      };

      /* ======================
          POPUP TRANSLATE
      =======================*/

      const popup = document.getElementById("translatePopup");
      const btnOpen = document.getElementById("openTranslatePopup");
      const btnClose = document.getElementById("btnClosePopup");
      const btnTranslate = document.getElementById("btnTranslate");

      btnOpen.onclick = () => popup.classList.remove("hidden");
      btnClose.onclick = () => popup.classList.add("hidden");

      btnTranslate.onclick = async () => {

        const text = document.getElementById("translateInput").value.trim();
        const out  = document.getElementById("translateOutput");

        if (!text) return out.textContent = "Hãy nhập câu!";

        out.textContent = "Đang dịch...";

        try {
          const res = await fetch("https://humble-doodle-69rwvr64wgjpfrv5-5501.app.github.dev/translate", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ text })
          });

          const data = await res.json();
          out.textContent = data.translated || "Lỗi: " + data.error;

        } catch (err) {
          out.textContent = "Không kết nối được server Python!";
        }
      };

    });

    /* ======================
   FIREBASE AUTH
====================== */

const loginPopup = document.getElementById("loginPopup");
const openLoginPopup = document.getElementById("openLoginPopup");
const closeLoginPopup = document.getElementById("btnCloseLogin");

openLoginPopup.onclick = () => loginPopup.classList.remove("hidden");
closeLoginPopup.onclick = () => loginPopup.classList.add("hidden");

document.getElementById("btnRegister").onclick = async () => {
  const email = document.getElementById("emailInput").value;
  const pass = document.getElementById("passwordInput").value;

  try {
    await auth.createUserWithEmailAndPassword(email, pass);
    document.getElementById("authMessage").textContent = "Đăng ký thành công!";
  } catch (e) {
    document.getElementById("authMessage").textContent = e.message;
  }
};

document.getElementById("btnLogin").onclick = async () => {
  const email = document.getElementById("emailInput").value;
  const pass = document.getElementById("passwordInput").value;

  try {
    await auth.signInWithEmailAndPassword(email, pass);
    document.getElementById("authMessage").textContent = "Đăng nhập thành công!";
    loginPopup.classList.add("hidden");
  } catch (e) {
    document.getElementById("authMessage").textContent = e.message;
  }
};

// Theo dõi trạng thái đăng nhập
auth.onAuthStateChanged(user => {
  if (user) {
    console.log("Đã đăng nhập:", user.email);
  } else {
    console.log("Chưa đăng nhập");
  }
});

  </script>

</body>
</html>
